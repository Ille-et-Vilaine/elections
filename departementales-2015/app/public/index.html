<!DOCTYPE html>
<html>
    <head>
      <title>Élections départementales 2015 - Carte des cantons et liste des candidats</title>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
      <link href='http://fonts.googleapis.com/css?family=Cabin' rel='stylesheet' type='text/css'>
      <link rel="stylesheet" href="./css/app.css" />
    </head>

    <body>
      <div id="main">
        <div id="map">
        </div>
      </div>
    </body>

    <script src="http://blog.apps.npr.org/pym.js/dist/pym.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
    <script src="./js/jquery-2.1.3.min.js"></script>
    <script src="./js/leaflet-omnivore.js"></script>
    <script src="./js/leaflet.activearea.js"></script>
    <script src="./js/app.js"></script>
    <script>
      jQuery(document).ready(function($) {
        var dataset, pymChild, app;

        /**
         * Only if inside an iframe
         */
        if (self !== top && pym) {
          pymChild = new pym.Child();

          /**
           * Inform parent we are ready
           */
          pymChild.sendMessage('event', 'ready');

          /**
           * Manage data sent by parent
           */
          pymChild.onMessage('data', function (data) {
            try {
              dataset = JSON.parse(data);
              app = new App(dataset);
              app.init();
            } catch (e) {
              console.error("Parsing error:", e);
              app = new App();
              app.init();
            }
          });
        } else {
          app = new App();
          app.init();
        }
      });
    </script>
</html>

